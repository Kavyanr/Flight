package com.flightBooking.controller;

import java.util.Optional;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PathVariable;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestBody;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;

import com.flightBooking.model.BookingDetails;
import com.flightBooking.repository.FlightBookingRepository;

@RestController
@RequestMapping("/api/v1.0/flight")
public class FlightBookingController {
	
	@Autowired 
	private FlightBookingRepository bookingRepository;
	
	@PostMapping("/booking/{mailId}")
	public String BookTicket(@RequestBody BookingDetails booking, @PathVariable("mailId") String mailId) {
		booking.setTotal_amount(calculateTotalAmount(booking));
		boolean resultData = bookingRepository.findById(booking.getBookingId()).isPresent();
		if(resultData == false) {
			bookingRepository.save(booking);
			return emailService.sendMail(booking,mailId);
		}
		return "Already booking is done";
		
	}
	
	private double calculateTotalAmount(BookingDetails booking) {
		// TODO Auto-generated method stub
		return 0;
	}

	@GetMapping("/ticket/{flightId}")
	public Optional<BookingDetails> getTickets(@PathVariable("flightId") int bookingId){
		try {
			//log.info("Retrieve ticket: " + bookingId);
			return bookingRepository.findById(bookingId);
		}
		catch(Exception e) {
			return bookingRepository.findById(bookingId);
		}
		
	}
	

}
